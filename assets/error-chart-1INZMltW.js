import{d as C,c as S,u as j,t as p,j as c}from"./index-Cd1laDTm.js";import{C as T}from"./index-sIeuqy0S.js";import{u as D,C as E}from"./useChart-mZZFt-L0.js";import{r as l}from"./vendor-core-Cler3e7Q.js";import{M as L,t as H}from"./vendor-ui-DfPY-v6q.js";const R=(i,h,u,d)=>S.get({url:"/om/stat/error/time",params:{start:i,end:h,unit:u,filter:d},paramsSerializer:{serialize:a=>{const s=new URLSearchParams;for(const[m,o]of Object.entries(a))if(Array.isArray(o))for(const y of o)s.append(m,y);else s.append(m,String(o));return s.toString()}}}),O=C(R,200),U={errorTimeRange:O},w=["error","panic"];function z({open:i,onClose:h,enabled:u=!0,serverKey:d}){const{t:a}=j(),[s,m]=l.useState("day"),[o,y]=l.useState([]),b=l.useMemo(()=>[p.colors.palette.error.dark,p.colors.palette.error.default],[]),x=l.useMemo(()=>{switch(s){case"hour":return"HH:mm";case"day":return"MM-dd HH:mm";case"week":case"month":return"yyyy-MM-dd";default:return"yyyy-MM-dd HH:mm"}},[s]),f=l.useCallback(async t=>{try{const e=Math.floor(Date.now()/1e3);let r,n;switch(t){case"hour":r=e-3600,n="minute";break;case"day":r=e-86400,n="hour";break;case"week":r=e-604800,n="day";break;case"month":r=e-2592e3,n="day";break;default:r=e-86400,n="hour"}const M=await U.errorTimeRange(r,e,n,w);y(M)}catch{}},[]);l.useEffect(()=>{i&&u&&f(s)},[d,i,u,s,f]);const k=l.useMemo(()=>{if(!o.length)return[];const t=e=>{switch(e){case"error":return a("sys.workbench.anomalyError");case"panic":return a("sys.workbench.anomalyPanic");default:return e}};return w.map(e=>({name:t(e),data:o.map(r=>{const n=r.value[e]||0;return{x:Number(r.at)*1e3,y:n}})}))},[o,a]),g=l.useMemo(()=>{if(o.length)return o.reduce((t,e)=>{const r=e.value,n=(r.error||0)+(r.panic||0);return Math.max(t,n)},0)+1},[o]),v=D({colors:b,xaxis:{type:"datetime",labels:{datetimeUTC:!1,format:x}},tooltip:{x:{formatter:t=>{switch(s){case"hour":case"day":return new Date(t).toLocaleString();case"week":case"month":return new Date(t).toLocaleDateString();default:return new Date(t).toLocaleString()}}},y:{formatter:t=>`${t}`}},yaxis:{labels:{formatter:t=>`${t}`},min:0,max:g},chart:{toolbar:{show:!1}},stroke:{curve:"smooth",width:2}});return c.jsx(L,{title:a("sys.workbench.anomalyTrend"),open:i&&u,onCancel:h,width:800,footer:null,style:{top:"15%"},styles:{body:{padding:"0px"}},maskClosable:!0,destroyOnClose:!0,children:c.jsxs(T,{className:"flex-col !shadow-none",children:[c.jsxs("header",{className:"flex w-full justify-between items-start",children:[c.jsx("div",{}),c.jsx(H,{size:"small",value:s,onChange:m,style:{width:110,marginTop:10},options:[{value:"hour",label:a("sys.workbench.lastHour")},{value:"day",label:a("sys.workbench.lastDay")},{value:"week",label:a("sys.workbench.lastWeek")},{value:"month",label:a("sys.workbench.lastMonth")}]})]}),c.jsx("main",{className:"w-full",children:c.jsx(E,{type:"area",series:k,options:v,height:350,style:{marginLeft:"-15px"}})})]})})}const $=Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"}));export{z as E,$ as e,U as s};
