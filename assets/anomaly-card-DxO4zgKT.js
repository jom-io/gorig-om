import{u as C,a as S,t as s,j as e,b as E}from"./index-Dxt0SIoD.js";import{s as A,E as T}from"./error-chart-BXP-FX1a.js";import{C as $}from"./index-D80nntVj.js";import{z as h,S as U}from"./vendor-ui-DfPY-v6q.js";import{r as t}from"./vendor-core-Cler3e7Q.js";import"./vendor-utils-Bw_55G97.js";import"./useChart-wIJC3itz.js";import"./vendor-charts-BXYW9_WM.js";function M(){const{t:a}=C(),o=S(),[i,d]=t.useState(!1),[y,g]=t.useState({error:0,panic:0}),[m,p]=t.useState(""),[j,x]=t.useState(!1),u=t.useCallback(async()=>{if(o)try{x(!0);const r=h(),v=r.startOf("day").unix(),N=r.unix(),l=await A.errorTimeRange(v,N,"5m",["error","panic"]),n={error:0,panic:0};for(const c of l){const f=c.value;n.error+=f.error||0,n.panic+=f.panic||0}if(g(n),l.length>0){const c=Number(l[l.length-1].at);p(h.unix(c).format("HH:mm"))}else p("")}catch{}finally{x(!1)}},[o]);t.useEffect(()=>{u()},[u]);const b=t.useMemo(()=>[{key:"error",label:a("sys.workbench.anomalyError"),color:s.colors.palette.error.dark},{key:"panic",label:a("sys.workbench.anomalyPanic"),color:s.colors.palette.error.default}],[a]),w=()=>{!o||i||d(!0)},k=`linear-gradient(135deg, rgba(${s.colors.palette.error.lightChannel}, 0.14), rgba(${s.colors.palette.primary.lightChannel}, 0.12)) ${s.colors.background.paper}`;return e.jsxs("div",{onClick:w,className:"h-full w-full",children:[e.jsx(U,{spinning:j,className:"h-full",children:e.jsx($,{className:"!p-0 overflow-hidden h-full w-full",style:{background:k,padding:0,boxShadow:s.shadows.card,cursor:"pointer"},children:e.jsxs("div",{className:"flex h-full flex-col gap-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",style:{color:s.colors.text.primary},children:a("sys.workbench.anomalyToday")}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-4",children:b.map(r=>e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase",style:{color:r.color},children:r.label}),e.jsx("span",{className:"text-2xl font-bold",style:{color:s.colors.text.primary},children:y[r.key]??0}),e.jsx("span",{className:"text-sm",style:{color:s.colors.text.secondary},children:a("sys.workbench.anomalyUnit")})]},r.key))})]}),e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full",style:{background:`rgba(${s.colors.palette.error.defaultChannel}, 0.16)`,color:s.colors.palette.error.dark},children:e.jsx(E,{icon:"mdi:alert-decagram",size:26})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",style:{color:s.colors.text.secondary},children:[e.jsx("span",{children:a("sys.workbench.anomalyDesc")}),e.jsx("div",{className:"flex items-center gap-3",children:m?e.jsx("span",{className:"text-xs",children:a("sys.workbench.anomalyUpdated",{time:m})}):e.jsx("span",{className:"text-xs",children:"--"})})]})]})})}),e.jsx(T,{open:i,onClose:()=>d(!1),enabled:!!o,serverKey:o?.addr})]})}export{M as default};
