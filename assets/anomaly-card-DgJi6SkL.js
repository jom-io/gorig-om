import{u as C,a as S,t as s,j as e,b as E}from"./index-Cd1laDTm.js";import{s as A,E as T}from"./error-chart-1INZMltW.js";import{C as $}from"./index-sIeuqy0S.js";import{z as h}from"./vendor-ui-DfPY-v6q.js";import{r as a}from"./vendor-core-Cler3e7Q.js";import"./vendor-utils-Bw_55G97.js";import"./useChart-mZZFt-L0.js";import"./vendor-charts-BXYW9_WM.js";function L(){const{t}=C(),o=S(),[d,n]=a.useState(!1),[y,g]=a.useState({error:0,panic:0}),[m,p]=a.useState(""),[b,x]=a.useState(!1),u=a.useCallback(async()=>{if(o)try{x(!0);const r=h(),v=r.startOf("day").unix(),N=r.unix(),l=await A.errorTimeRange(v,N,"hour",["error","panic"]),c={error:0,panic:0};if(l.forEach(i=>{const f=i.value;c.error+=f.error||0,c.panic+=f.panic||0}),g(c),l.length>0){const i=Number(l[l.length-1].at);p(h.unix(i).format("HH:mm"))}else p("")}catch{}finally{x(!1)}},[o]);a.useEffect(()=>{u()},[u]),a.useEffect(()=>{n(!1)},[o]);const j=a.useMemo(()=>[{key:"error",label:t("sys.workbench.anomalyError"),color:s.colors.palette.error.dark},{key:"panic",label:t("sys.workbench.anomalyPanic"),color:s.colors.palette.error.default}],[t]),w=()=>{!o||d||n(!0)},k=`linear-gradient(135deg, rgba(${s.colors.palette.error.lightChannel}, 0.14), rgba(${s.colors.palette.primary.lightChannel}, 0.12)) ${s.colors.background.paper}`;return e.jsxs($,{className:"!p-0 overflow-hidden h-full w-full",style:{background:k,padding:0,boxShadow:s.shadows.card,cursor:"pointer"},loading:b,onClick:w,children:[e.jsxs("div",{className:"flex h-full flex-col gap-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",style:{color:s.colors.text.primary},children:t("sys.workbench.anomalyToday")}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-4",children:j.map(r=>e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase",style:{color:r.color},children:r.label}),e.jsx("span",{className:"text-2xl font-bold",style:{color:s.colors.text.primary},children:y[r.key]??0}),e.jsx("span",{className:"text-sm",style:{color:s.colors.text.secondary},children:t("sys.workbench.anomalyUnit")})]},r.key))})]}),e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full",style:{background:`rgba(${s.colors.palette.error.defaultChannel}, 0.16)`,color:s.colors.palette.error.dark},children:e.jsx(E,{icon:"mdi:alert-decagram",size:26})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",style:{color:s.colors.text.secondary},children:[e.jsx("span",{children:t("sys.workbench.anomalyDesc")}),e.jsx("div",{className:"flex items-center gap-3",children:m?e.jsx("span",{className:"text-xs",children:t("sys.workbench.anomalyUpdated",{time:m})}):e.jsx("span",{className:"text-xs",children:"--"})})]})]}),e.jsx(T,{open:d,onClose:()=>n(!1),enabled:!!o,serverKey:o?.addr})]})}export{L as default};
