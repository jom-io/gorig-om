import{u as V,a as z,t as a,j as e,b as I}from"./index-Z0GYpP5h.js";import{s as w,E as F}from"./error-chart-DSfQiszi.js";import{C as L}from"./index-DvzqBE2T.js";import{z as k,S as M}from"./vendor-ui-Bdifwvp0.js";import{r as n}from"./vendor-core-Cler3e7Q.js";import"./vendor-utils-DG9TG-F2.js";import"./useChart-Dpwc2KQB.js";import"./vendor-charts-BXYW9_WM.js";function X(){const{t:l}=V(),c=z(),[u,x]=n.useState(!1),[C,N]=n.useState({error:0,panic:0}),[h,y]=n.useState(""),[S,g]=n.useState(!1),[E,$]=n.useState({error:null,panic:null}),j=n.useCallback(async()=>{if(c)try{g(!0);const s=k(),r=s.startOf("day").unix(),i=s.unix(),d=await w.errorTimeRange(r,i,"5m",["error","panic"]),m={error:0,panic:0};for(const t of d){const o=t.value;m.error+=o.error||0,m.panic+=o.panic||0}N(m);const H=i-r,b=s.subtract(1,"day").startOf("day").unix(),O=b+H,P=await w.errorTimeRange(b,O,"5m",["error","panic"]),f={error:0,panic:0};for(const t of P){const o=t.value;f.error+=o.error||0,f.panic+=o.panic||0}const p={error:null,panic:null};for(const t of["error","panic"]){const o=f[t],v=m[t];o===0?p[t]=v>0?100:0:p[t]=(v-o)/o*100}if($(p),d.length>0){const t=Number(d[d.length-1].at);y(k.unix(t).format("HH:mm"))}else y("")}catch{}finally{g(!1)}},[c]);n.useEffect(()=>{j()},[j]);const T=n.useMemo(()=>[{key:"error",label:l("sys.workbench.anomalyError"),color:a.colors.palette.error.dark},{key:"panic",label:l("sys.workbench.anomalyPanic"),color:a.colors.palette.error.default}],[l]),A=()=>{!c||u||x(!0)},R=`linear-gradient(135deg, rgba(${a.colors.palette.error.lightChannel}, 0.14), rgba(${a.colors.palette.primary.lightChannel}, 0.12)) ${a.colors.background.paper}`,U=s=>{const r=E[s];if(r==null)return null;const i=r>=0;return{text:`${r>0?"+":""}${r.toFixed(1)}% ${l("sys.workbench.anomalyChange")}`,color:i?"#ff4d4f":"#52c41a"}};return e.jsxs("div",{onClick:A,className:"h-full w-full",children:[e.jsx(M,{spinning:S,className:"h-full",children:e.jsx(L,{className:"!p-0 overflow-hidden h-full w-full",style:{background:R,padding:0,boxShadow:a.shadows.card,cursor:"pointer",minHeight:133},children:e.jsx("div",{className:"flex h-full flex-col gap-4 p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",style:{color:a.colors.text.primary},children:l("sys.workbench.anomalyToday")}),e.jsx("div",{className:"mt-3 flex flex-wrap items-end gap-4 justify-between",children:e.jsx("div",{className:"flex flex-wrap gap-4",children:T.map(s=>{const r=U(s.key);return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase",style:{color:s.color},children:s.label}),e.jsx("span",{className:"text-2xl font-bold",style:{color:a.colors.text.primary},children:C[s.key]??0}),e.jsx("span",{className:"text-sm",style:{color:a.colors.text.secondary},children:l("sys.workbench.anomalyUnit")})]}),r&&e.jsx("span",{className:"text-xs mt-1",style:{color:r.color},children:r.text})]},s.key)})})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 justify-start mt-1",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full",style:{background:`rgba(${a.colors.palette.error.defaultChannel}, 0.16)`,color:a.colors.palette.error.dark},children:e.jsx(I,{icon:"mdi:alert-decagram",size:26})}),h&&e.jsx("span",{className:"text-xs mt-4",style:{color:a.colors.text.secondary},children:l("sys.workbench.anomalyUpdated",{time:h})})]})]})})})}),e.jsx(F,{open:u,onClose:()=>x(!1),enabled:!!c})]})}export{X as default};
