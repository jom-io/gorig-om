import{u as V,a as z,t,j as e,b as I}from"./index-BERtlmQb.js";import{s as v}from"./api-sample-modal-DF60HdJW.js";import{C as F}from"./index-DCpAUovq.js";import{z as k,S as L}from"./vendor-ui-DHYkxuVK.js";import{r as n}from"./vendor-core-D3G3Pc5t.js";import M from"./error-chart-B3tXkMD_.js";import"./vendor-utils-CsjJZ8C9.js";import"./useChart-BUFOfR3x.js";import"./vendor-charts-C0vSEv4L.js";import"./anomaly-sample-modal-BHpqpA8t.js";import"./api-latency-chart-CP2UWLJS.js";function _(){const{t:l}=V(),c=z(),[u,x]=n.useState(!1),[C,N]=n.useState({error:0,panic:0}),[h,y]=n.useState(""),[S,g]=n.useState(!1),[$,E]=n.useState({error:null,panic:null}),j=n.useCallback(async()=>{if(c)try{g(!0);const r=k(),s=r.startOf("day").unix(),i=r.unix(),d=await v.errorTimeRange(s,i,"5m",["error","panic"]),m={error:0,panic:0};for(const a of d){const o=a.value;m.error+=o.error||0,m.panic+=o.panic||0}N(m);const H=i-s,b=r.subtract(1,"day").startOf("day").unix(),O=b+H,P=await v.errorTimeRange(b,O,"5m",["error","panic"]),p={error:0,panic:0};for(const a of P){const o=a.value;p.error+=o.error||0,p.panic+=o.panic||0}const f={error:null,panic:null};for(const a of["error","panic"]){const o=p[a],w=m[a];o===0?f[a]=w>0?100:0:f[a]=(w-o)/o*100}if(E(f),d.length>0){const a=Number(d[d.length-1].at);y(k.unix(a).format("HH:mm"))}else y("")}catch{}finally{g(!1)}},[c]);n.useEffect(()=>{j()},[j]);const T=n.useMemo(()=>[{key:"error",label:l("sys.workbench.anomalyError"),color:t.colors.palette.error.dark},{key:"panic",label:l("sys.workbench.anomalyPanic"),color:t.colors.palette.error.default}],[l]),A=()=>{!c||u||x(!0)},R=`linear-gradient(135deg, rgba(${t.colors.palette.error.lightChannel}, 0.14), rgba(${t.colors.palette.primary.lightChannel}, 0.12)) ${t.colors.background.paper}`,U=r=>{const s=$[r];if(s==null)return null;const i=s>=0;return{text:`${s>0?"+":""}${s.toFixed(1)}% ${l("sys.workbench.anomalyChange")}`,color:i?"#ff4d4f":"#52c41a"}};return e.jsxs("div",{onClick:A,className:"h-full w-full",children:[e.jsx(L,{spinning:S,className:"h-full",children:e.jsx(F,{className:"!p-0 overflow-hidden h-full w-full",style:{background:R,padding:0,boxShadow:t.shadows.card,cursor:"pointer",minHeight:133},children:e.jsx("div",{className:"flex h-full flex-col gap-4 p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",style:{color:t.colors.text.primary},children:l("sys.workbench.anomalyToday")}),e.jsx("div",{className:"mt-3 flex flex-wrap items-end gap-4 justify-between",children:e.jsx("div",{className:"flex flex-wrap gap-4",children:T.map(r=>{const s=U(r.key);return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase",style:{color:r.color},children:r.label}),e.jsx("span",{className:"text-2xl font-bold",style:{color:t.colors.text.primary},children:C[r.key]??0}),e.jsx("span",{className:"text-sm",style:{color:t.colors.text.secondary},children:l("sys.workbench.anomalyUnit")})]}),s&&e.jsx("span",{className:"text-xs mt-1",style:{color:s.color},children:s.text})]},r.key)})})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 justify-start mt-1",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full",style:{background:`rgba(${t.colors.palette.error.defaultChannel}, 0.16)`,color:t.colors.palette.error.dark},children:e.jsx(I,{icon:"mdi:alert-decagram",size:26})}),h&&e.jsx("span",{className:"text-xs mt-4 whitespace-nowrap",style:{color:t.colors.text.secondary},children:l("sys.workbench.anomalyUpdated",{time:h})})]})]})})})}),e.jsx(M,{open:u,onClose:()=>x(!1),enabled:!!c})]})}export{_ as default};
