import{u as z,j as r,I as m,b as k}from"./index-Dxt0SIoD.js";import{d as j}from"./deployService-DbSrXbhz.js";import{r as i}from"./vendor-core-Cler3e7Q.js";import{E as t,M as I,I as g}from"./vendor-ui-DfPY-v6q.js";import"./vendor-utils-Bw_55G97.js";const P=({visible:u,onClose:v})=>{const{t:a}=z(),[n,c]=i.useState([]),[N,y]=i.useState(!1),[l,b]=i.useState({key:"",value:""}),f=i.useCallback(async()=>{try{y(!0);const e=await j.getGoEnv();c(e||[])}catch{t.error(a("deploy.sys.cicd.env.loadFailed")),c([])}finally{y(!1)}},[a]);i.useEffect(()=>{u?f():c([])},[u,f]);const p=(e,s)=>n.some((o,d)=>o.key===e&&d!==s),E=()=>{if(!l.key||!l.value){t.error(a("deploy.sys.cicd.env.incomplete"));return}if(p(l.key)){t.error(a("deploy.sys.cicd.env.duplicateKey"));return}c([...n,{...l,default:!1}]),b({key:"",value:""})},w=e=>{const s=[...n];s.splice(e,1),c(s)},x=(e,s,o)=>{if(s==="key"&&p(o,e)){t.error(a("deploy.sys.cicd.env.duplicateKey"));return}const d=[...n];d[e]={...d[e],[s]:o},c(d)},h=(e,s)=>{b(o=>({...o,[e]:s}))},C=async()=>{let e=[...n];if(l.key&&l.value){if(p(l.key)){t.error(a("deploy.sys.cicd.env.duplicateKey"));return}e=[...n,{...l,default:!1}]}if(e.find(d=>!d.key||!d.value)){t.error(a("deploy.sys.cicd.env.incomplete"));return}const o=e.map(d=>d.key);if(new Set(o).size!==o.length){t.error(a("deploy.sys.cicd.env.duplicateKey"));return}try{y(!0),await j.setGoEnv(e),t.success(a("deploy.sys.cicd.env.saveSuccess")),b({key:"",value:""}),v()}catch{}finally{y(!1)}};return r.jsx(I,{title:a("deploy.sys.cicd.env.title"),open:u,onCancel:v,width:580,onOk:C,confirmLoading:N,styles:{mask:{backgroundColor:"rgba(0, 0, 0, 0.75)"},body:{padding:"16px"}},children:r.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded",children:[r.jsxs("div",{className:"grid grid-cols-[180px_1fr_60px] gap-2 px-3 py-2 bg-[var(--colors-background-neutral)] border-b border-gray-200 dark:border-gray-700",children:[r.jsx("div",{className:"font-medium text-[var(--colors-text-secondary)]",children:a("deploy.sys.cicd.env.key")}),r.jsx("div",{className:"font-medium text-[var(--colors-text-secondary)]",children:a("deploy.sys.cicd.env.value")}),r.jsx("div",{className:"text-center font-medium text-[var(--colors-text-secondary)] whitespace-nowrap",children:a("deploy.sys.cicd.env.operation")})]}),r.jsxs("div",{className:"max-h-[400px] overflow-y-auto",children:[n.map((e,s)=>r.jsxs("div",{className:"grid grid-cols-[180px_1fr_60px] gap-2 px-3 py-1 border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50/50 dark:hover:bg-gray-800/50",children:[r.jsx(g,{placeholder:a("deploy.sys.cicd.env.keyPlaceholder"),value:e.key,onChange:o=>x(s,"key",o.target.value),disabled:!!e.default,size:"small",bordered:!1,className:"bg-transparent hover:bg-gray-100/50 dark:hover:bg-gray-700/50 focus:bg-gray-100/50 dark:focus:bg-gray-700/50 [&:not(:disabled)]:border-b [&:not(:disabled)]:border-gray-300 dark:[&:not(:disabled)]:border-gray-600 [&:not(:disabled)]:rounded-none [&:not(:disabled)]:px-0 text-xs"}),r.jsx(g,{placeholder:a("deploy.sys.cicd.env.valuePlaceholder"),value:e.value,onChange:o=>x(s,"value",o.target.value),disabled:!!e.default,size:"small",bordered:!1,className:"bg-transparent hover:bg-gray-100/50 dark:hover:bg-gray-700/50 focus:bg-gray-100/50 dark:focus:bg-gray-700/50 [&:not(:disabled)]:border-b [&:not(:disabled)]:border-gray-300 dark:[&:not(:disabled)]:border-gray-600 [&:not(:disabled)]:rounded-none [&:not(:disabled)]:px-0 text-xs"}),!e.default&&r.jsx("div",{className:"flex justify-center",children:r.jsx(m,{onClick:()=>w(s),className:"text-error hover:text-error/80",children:r.jsx(k,{icon:"mdi:minus-circle-outline",size:14})})})]},`${e.key}-${s}`)),r.jsxs("div",{className:"grid grid-cols-[180px_1fr_60px] gap-2 px-3 py-1 border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50/50 dark:hover:bg-gray-800/50",children:[r.jsx(g,{placeholder:a("deploy.sys.cicd.env.keyPlaceholder"),value:l.key,onChange:e=>h("key",e.target.value),size:"small",bordered:!1,className:"bg-transparent hover:bg-gray-100/50 dark:hover:bg-gray-700/50 focus:bg-gray-100/50 dark:focus:bg-gray-700/50 border-b border-gray-300 dark:border-gray-600 rounded-none px-0 text-xs"}),r.jsx(g,{placeholder:a("deploy.sys.cicd.env.valuePlaceholder"),value:l.value,onChange:e=>h("value",e.target.value),size:"small",bordered:!1,className:"bg-transparent hover:bg-gray-100/50 dark:hover:bg-gray-700/50 focus:bg-gray-100/50 dark:focus:bg-gray-700/50 border-b border-gray-300 dark:border-gray-600 rounded-none px-0 text-xs"}),r.jsx("div",{className:"flex justify-center",children:r.jsx(m,{onClick:E,className:"text-primary hover:text-primary/80",children:r.jsx(k,{icon:"mdi:plus-circle-outline",size:14})})})]})]})]})})};export{P as default};
