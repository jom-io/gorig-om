import{u as E,t as o,j as e}from"./index-BfkEEPVp.js";import{C as S}from"./index-pSMxbn9e.js";import{u as I,C as N}from"./useChart-B-frxR9p.js";import{r as d}from"./vendor-core-Cler3e7Q.js";import{T as b,s as f,M as O,t as P,G as R}from"./vendor-ui-Bdifwvp0.js";import"./vendor-utils-DG9TG-F2.js";import"./vendor-charts-BXYW9_WM.js";const U=["2xx","4xx","5xx"],$=[{value:"5m",label:"Last 5m"},{value:"10m",label:"Last 10m"},{value:"30m",label:"Last 30m"},{value:"hour",label:"Last Hour"},{value:"day",label:"Last Day"},{value:"week",label:"Last Week"},{value:"month",label:"Last Month"}],D=[{method:"GET",uri:"/api/v1/users",baseline:2400},{method:"POST",uri:"/api/v1/orders",baseline:1600},{method:"GET",uri:"/api/v1/orders/:id",baseline:1200},{method:"PUT",uri:"/api/v1/orders/:id",baseline:640},{method:"GET",uri:"/api/v1/products",baseline:3100},{method:"GET",uri:"/api/v1/products/:id",baseline:1500},{method:"POST",uri:"/api/v1/checkout",baseline:900},{method:"DELETE",uri:"/api/v1/carts/:id",baseline:420}],G=r=>{switch(r){case"5m":return{points:12,stepMs:5*60*1e3};case"10m":return{points:12,stepMs:10*60*1e3};case"30m":return{points:12,stepMs:30*60*1e3};case"hour":return{points:24,stepMs:60*60*1e3};case"day":return{points:24,stepMs:60*60*1e3};case"week":return{points:14,stepMs:12*60*60*1e3};case"month":return{points:30,stepMs:24*60*60*1e3};default:return{points:24,stepMs:60*60*1e3}}},p=(r,i)=>Math.max(0,Math.round(r+(Math.random()-.5)*i)),A=r=>{const{points:i,stepMs:h}=G(r),a=Date.now(),c=[];for(let x=i-1;x>=0;x-=1){const n=a-h*x,u=.9+Math.random()*.4,m=p(160*u,70),y=p(26*u,16),T=p(12*u,10);c.push({at:n,counts:{"2xx":m,"4xx":y,"5xx":T}})}return c},W=()=>{const r=[];for(const i of D){const h=.85+Math.random()*.35,a=Math.round(i.baseline*h),c=Math.max(3,Math.round(a*(.015+Math.random()*.02))),x=Math.max(6,Math.round(a*(.05+Math.random()*.03))),n=Math.max(a-x-c,0),u=p(120+r.length*8,80),m=u+120+p(30,40),y=m+p(120,80);r.push({method:i.method,uri:i.uri,count:a,status2xx:n,status4xx:x,status5xx:c,avgLatency:u,maxLatency:y,p95Latency:m,sampleTrace:Math.random()>.5?`trace-${Math.random().toString(16).slice(2,10)}`:void 0})}return r},M=r=>`${r} ms`;function B({open:r,onClose:i,enabled:h=!0}){const{t:a}=E(),[c,x]=d.useState("hour"),[n,u]=d.useState([]),[m,y]=d.useState([]);d.useEffect(()=>{r&&h&&(u(A(c)),y(W()))},[r,h,c]);const T=d.useMemo(()=>n.length?U.map(t=>({name:t,data:n.map(s=>({x:s.at,y:s.counts[t]}))})):[],[n]),l=d.useMemo(()=>[o.colors.palette.success.dark,o.colors.palette.warning.dark,o.colors.palette.error.dark],[]),v=d.useMemo(()=>({GET:o.colors.palette.primary.dark,POST:o.colors.palette.success.dark,PUT:o.colors.palette.warning.dark,DELETE:o.colors.palette.error.dark}),[]),j=d.useMemo(()=>$.map(t=>({...t,label:a(`sys.workbench.time.${t.value}`,t.label)})),[a]),L=I({colors:l,xaxis:{type:"datetime",labels:{datetimeUTC:!1}},yaxis:{labels:{formatter:t=>`${t}`},min:0},tooltip:{y:{formatter:t=>`${t} req`}},chart:{toolbar:{show:!1}},stroke:{width:2,curve:"smooth"}}),C=[{title:a("sys.workbench.apiColMethod","Method"),dataIndex:"method",key:"method",width:80,render:t=>e.jsx(b,{color:v[t]||o.colors.palette.primary.default,children:t})},{title:"URL",dataIndex:"uri",key:"uri",width:200,ellipsis:{showTitle:!1},render:t=>e.jsx(f.Text,{style:{maxWidth:200},ellipsis:{tooltip:t},children:t})},{title:a("sys.workbench.apiColTotal","Total"),dataIndex:"count",key:"count",sorter:(t,s)=>t.count-s.count,defaultSortOrder:"descend",width:90,align:"right"},{title:"2xx",dataIndex:"status2xx",key:"status2xx",sorter:(t,s)=>t.status2xx-s.status2xx,width:80,align:"right"},{title:"4xx",dataIndex:"status4xx",key:"status4xx",sorter:(t,s)=>t.status4xx-s.status4xx,width:80,align:"right"},{title:"5xx",dataIndex:"status5xx",key:"status5xx",sorter:(t,s)=>t.status5xx-s.status5xx,width:80,align:"right",render:t=>e.jsx(f.Text,{strong:!0,style:{color:o.colors.palette.error.dark},children:t})},{title:a("sys.workbench.apiColAvg","Avg"),dataIndex:"avgLatency",key:"avgLatency",sorter:(t,s)=>t.avgLatency-s.avgLatency,width:90,render:t=>M(t)},{title:"P95",dataIndex:"p95Latency",key:"p95Latency",sorter:(t,s)=>t.p95Latency-s.p95Latency,width:90,render:t=>M(t)},{title:a("sys.workbench.apiColMax","Max"),dataIndex:"maxLatency",key:"maxLatency",sorter:(t,s)=>t.maxLatency-s.maxLatency,width:90,render:t=>M(t)},{title:"Trace",dataIndex:"sampleTrace",key:"sampleTrace",width:200,render:t=>t?e.jsx(f.Text,{code:!0,copyable:!0,ellipsis:{tooltip:t},style:{maxWidth:200},children:t}):e.jsx(f.Text,{type:"secondary",children:"-"})}],k=d.useMemo(()=>{if(!n.length)return{total:0,ok:0,err4:0,err5:0};let t=0,s=0,g=0;for(const w of n)t+=w.counts["2xx"],s+=w.counts["4xx"],g+=w.counts["5xx"];return{total:t+s+g,ok:t,err4:s,err5:g}},[n]);return e.jsx(O,{title:a("sys.workbench.apiTrendTitle","API Response Trend"),open:r&&h,onCancel:i,width:960,footer:null,style:{top:"6%"},styles:{body:{padding:0}},maskClosable:!0,destroyOnClose:!0,children:e.jsxs(S,{className:"flex-col !shadow-none",children:[e.jsxs("header",{className:"flex w-full justify-between items-start gap-4",children:[e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs(b,{color:l[0],style:{borderColor:l[0],background:l[0],color:"#fff"},children:["2xx ",k.ok]}),e.jsxs(b,{color:l[1],style:{borderColor:l[1],background:l[1],color:"#fff"},children:["4xx ",k.err4]}),e.jsxs(b,{color:l[2],style:{borderColor:l[2],background:l[2],color:"#fff"},children:["5xx ",k.err5]}),e.jsx(f.Text,{type:"secondary",children:a("sys.workbench.apiTotalCount",{count:k.total,defaultValue:"Total {{count}} times"})})]}),e.jsx(P,{size:"small",value:c,onChange:x,style:{width:150},options:j})]}),e.jsxs("main",{className:"w-full flex flex-col gap-4 mt-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(N,{type:"area",series:T,options:L,height:360})}),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex items-center justify-between mb-2 px-1",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-medium",style:{color:o.colors.text.primary},children:a("sys.workbench.apiRankingTitle","Endpoint latency ranking")}),e.jsx("span",{className:"text-xs",style:{color:o.colors.text.secondary},children:a("sys.workbench.apiRankingDesc","Sortable by status counts and latency columns. Mock data only.")})]})}),e.jsx(R,{rowKey:t=>`${t.method}-${t.uri}`,dataSource:m,size:"small",pagination:!1,columns:C})]})]})]})})}export{B as default};
