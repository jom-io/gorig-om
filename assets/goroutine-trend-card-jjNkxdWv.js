import{u as j,a as C,t as r,j as t}from"./index-DWD_6FxE.js";import{s as v}from"./statService-DIGahmug.js";import{C as w}from"./index-k__wfER6.js";import{u as S}from"./useChart-CGXm_jHt.js";import{z as d,S as k}from"./vendor-ui-B8JNe9Dz.js";import{r as o}from"./vendor-core-D3G3Pc5t.js";import{A as N}from"./vendor-charts-C0vSEv4L.js";import T from"./RefreshIcon-BI2Hh287.js";import"./vendor-utils-9ATX-dPw.js";function O(){const{t:s}=j(),a=C(),[p,m]=o.useState(!1),[n,h]=o.useState([]),[u,g]=o.useState(null),i=o.useCallback(async()=>{if(a)try{m(!0);const e=d(),f=e.startOf("day").unix(),b=e.unix(),l=await v.goroutineTime(f,b,"hour");h(l),l.length>0&&g(l[l.length-1].value.count)}catch{}finally{m(!1)}},[a]);o.useEffect(()=>{a&&i()},[a,i]);const c=o.useMemo(()=>n.length===0?{categories:[],series:[]}:{categories:n.map(e=>typeof e.at=="string"&&/^\d+$/.test(e.at)?d.unix(Number(e.at)).format("HH:mm"):d(e.at).format("HH:mm")),series:[{name:s("sys.workbench.goroutineCount"),data:n.map(e=>Math.round(e.value.count))}]},[n,s]),x=S({colors:[r.colors.palette.info.default],xaxis:{categories:c.categories,labels:{style:{fontSize:"11px"},rotate:-45,rotateAlways:!1,hideOverlappingLabels:!0}},yaxis:{labels:{formatter:e=>e.toLocaleString()}},grid:{padding:{top:-20,right:0,bottom:-10,left:10}},chart:{toolbar:{show:!1},zoom:{enabled:!1}},stroke:{width:2,curve:"smooth"},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.3,opacityTo:.1,stops:[0,100]}},tooltip:{y:{formatter:e=>e.toLocaleString()}}}),y=o.useMemo(()=>`linear-gradient(135deg, rgba(${r.colors.palette.info.lightChannel}, 0.12), rgba(${r.colors.palette.primary.lightChannel}, 0.14)) ${r.colors.background.paper}`,[]);return t.jsx(w,{className:"!p-0 overflow-hidden",style:{background:y,padding:0,boxShadow:r.shadows.card,height:"100%",width:"100%",flex:1,display:"flex",flexDirection:"column"},children:t.jsx(k,{spinning:p,style:{height:"100%",padding:0},wrapperClassName:"flex-1 flex flex-col",children:t.jsxs("div",{className:"flex h-full flex-col gap-1 p-5",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-lg font-medium",style:{color:r.colors.text.primary},children:s("sys.workbench.goroutineTrend")}),u!==null&&t.jsxs("div",{className:"mt-1",children:[t.jsx("span",{className:"text-2xl font-bold",style:{color:r.colors.text.primary},children:u.toLocaleString()}),t.jsx("span",{className:"text-xs ml-2",style:{color:r.colors.text.secondary},children:s("sys.workbench.goroutineCurrent")})]})]}),t.jsx(T,{background:`rgba(${r.colors.palette.info.defaultChannel}, 0.18)`,color:r.colors.palette.info.dark,icon:"mdi:chart-line",onClick:i})]}),c.categories.length>0?t.jsx("div",{style:{flex:1,marginTop:24,minHeight:160,marginBottom:0},children:t.jsx(N,{type:"area",series:c.series,options:x,height:"100%"})}):t.jsx("div",{style:{flex:1,marginTop:20,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("span",{style:{color:r.colors.text.secondary},children:"暂无数据"})})]})})})}export{O as default};
