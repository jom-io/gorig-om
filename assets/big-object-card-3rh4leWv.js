import{u as U,a as P,j as t,t as s}from"./index-rXTuJ1Ku.js";import{s as z}from"./statService-BGy6NpcV.js";import{C as G}from"./index-CPrIMGIy.js";import{z as y,S as K,M as W,G as V}from"./vendor-ui-B8JNe9Dz.js";import{r as n}from"./vendor-core-D3G3Pc5t.js";import _ from"./RefreshIcon-Ck_EDzqN.js";import{useTimeRange as q}from"./api-latency-chart-D4M35Lzx.js";import"./vendor-utils-9ATX-dPw.js";import"./chart-CjZAw-fG.js";import"./vendor-charts-C0vSEv4L.js";import"./useChart-DvQsmEio.js";import"./api-sample-modal-mfciSy6o.js";const v=o=>{if(o===0)return"0 B";const a=1024,b=["B","KB","MB","GB"],p=Math.floor(Math.log(Math.abs(o))/Math.log(a));return`${(o/a**p).toFixed(2)} ${b[p]}`};function ie(){const{t:o}=U(),a=P(),[b,p]=n.useState(!1),[C,N]=n.useState(0),[S,B]=n.useState(""),[i,w]=n.useState(!1),[M,$]=n.useState([]),[T,k]=n.useState(!1),[c,u]=n.useState({current:1,pageSize:10,total:0}),[r,A]=n.useState({field:"inuseSpace",order:"descend"}),{timeUnit:j,timeRange:D,getRange:O,renderTimePicker:H}=q("today",[y().startOf("day"),y()]),m=n.useCallback(async()=>{if(a)try{p(!0);const e=y(),l=e.startOf("day").unix(),h=e.unix(),d=await z.memBigCount(l,h);N(d),B(e.format("HH:mm"))}catch{}finally{p(!1)}},[a]),x=n.useCallback(async(e=1,l=10,h="inuseSpace",d=!1)=>{if(a)try{k(!0);const{start:f,end:L}=O(j),g=await z.memBigTop({start:f,end:L,page:e,size:l,sortBy:h,asc:d});$(g.items||[]),u(Y=>({...Y,current:g.page||1,pageSize:g.size||10,total:g.total||0}))}catch{}finally{k(!1)}},[a,j,O]);n.useEffect(()=>{a&&m()},[a,m]);const I=()=>{w(!0),u(e=>({...e,current:1}))},R=n.useCallback(e=>{e.stopPropagation(),m(),i&&a&&x(c.current,c.pageSize,r.field,r.order==="ascend")},[m,i,a,x,c.current,c.pageSize,r.field,r.order]);n.useEffect(()=>{i&&a&&u(e=>({...e,current:1}))},[i,a,j,D]),n.useEffect(()=>{i&&a&&x(1,c.pageSize,r.field,r.order==="ascend")},[i,a,x,c.pageSize,r.field,r.order]);const E=[{title:o("sys.workbench.bigObjectFunc"),dataIndex:"func",key:"func",width:400,render:(e,l)=>t.jsxs("div",{className:"flex flex-col py-0.5",style:{wordBreak:"break-all",whiteSpace:"normal"},children:[t.jsx("span",{style:{fontSize:"13px",fontFamily:"monospace",fontWeight:600,color:s.colors.text.primary,wordBreak:"break-all",whiteSpace:"normal",lineHeight:"1.4"},children:e}),t.jsxs("span",{className:"mt-0.5",style:{fontSize:"11px",color:s.colors.text.secondary,wordBreak:"break-all",whiteSpace:"normal",lineHeight:"1.4"},children:[l.file,":",l.line]})]})},{title:o("sys.workbench.bigObjectSpace"),dataIndex:"inuseSpace",key:"inuseSpace",width:80,align:"right",sorter:!0,sortOrder:r.field==="inuseSpace"?r.order:null,render:e=>t.jsx("span",{style:{fontSize:"13px",fontWeight:700,color:s.colors.palette.warning.dark},children:v(e)})},{title:o("sys.workbench.bigObjectObjects"),dataIndex:"inuseObjects",key:"inuseObjects",width:60,align:"right",sorter:!0,sortOrder:r.field==="inuseObjects"?r.order:null,render:e=>t.jsx("span",{style:{fontSize:"13px",color:s.colors.text.primary},children:e.toLocaleString()})},{title:o("sys.workbench.bigObjectAvgSize"),dataIndex:"avgObjSize",key:"avgObjSize",width:80,align:"right",sorter:!0,sortOrder:r.field==="avgObjSize"?r.order:null,render:e=>t.jsx("span",{style:{fontSize:"13px",color:s.colors.text.secondary},children:v(e)})},{title:o("sys.workbench.bigObjectLastAt"),dataIndex:"lastAt",key:"lastAt",width:80,align:"center",sorter:!0,sortOrder:r.field==="lastAt"?r.order:null,render:e=>{if(!e)return t.jsx("span",{style:{fontSize:"12px",color:s.colors.text.secondary},children:"-"});const l=y.unix(e);return t.jsxs("div",{className:"flex flex-col py-0.5",children:[t.jsx("span",{style:{fontSize:"12px",color:s.colors.text.primary},children:l.format("YYYY-MM-DD")}),t.jsx("span",{style:{fontSize:"11px",color:s.colors.text.secondary},children:l.format("HH:mm:ss")})]})}}],F=`linear-gradient(135deg, rgba(${s.colors.palette.warning.lightChannel}, 0.12), rgba(${s.colors.palette.primary.lightChannel}, 0.14)) ${s.colors.background.paper}`;return t.jsxs(t.Fragment,{children:[t.jsx(G,{className:"!p-0 overflow-hidden cursor-pointer hover:shadow-lg transition-shadow",onClick:I,style:{background:F,padding:0,boxShadow:s.shadows.card,height:133,width:"100%",display:"flex",flexDirection:"column",flexShrink:0},children:t.jsx(K,{spinning:b,style:{height:"100%"},wrapperClassName:"flex-1 flex flex-col",children:t.jsx("div",{className:"flex h-full flex-col justify-center p-4",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("div",{className:"text-lg font-medium",style:{color:s.colors.text.primary},children:o("sys.workbench.bigObjectTop")}),t.jsx("div",{className:"text-xs",style:{color:s.colors.text.secondary},children:o("sys.workbench.bigObjectDesc")}),t.jsxs("div",{className:"flex items-baseline gap-2 mt-6",children:[t.jsx("div",{className:"text-2xl font-bold",style:{color:s.colors.text.primary},children:C}),t.jsx("div",{className:"text-xs",style:{color:s.colors.text.secondary},children:o("sys.workbench.bigObjectUnit")})]})]}),t.jsxs("div",{className:"flex flex-col items-end gap-1 justify-center",children:[t.jsx(_,{background:`rgba(${s.colors.palette.warning.defaultChannel}, 0.18)`,color:s.colors.palette.warning.dark,icon:"mdi:database",onClick:R}),S&&t.jsx("span",{className:"mt-4 text-xs whitespace-nowrap",style:{color:s.colors.text.secondary},children:o("sys.workbench.bigObjectUpdatedAt",{time:S})})]})]})})})}),t.jsxs(W,{title:t.jsx("span",{className:"text-lg font-bold",children:o("sys.workbench.bigObjectTop")}),open:i,onCancel:()=>w(!1),footer:null,width:1e3,centered:!0,styles:{body:{paddingTop:"12px",maxHeight:"calc(100vh - 200px)",overflowY:"auto"}},children:[t.jsx("div",{className:"mb-4 flex items-center justify-end gap-2",children:H(()=>{u(e=>({...e,current:1}))})}),t.jsx(V,{dataSource:M,columns:E,loading:T,pagination:{...c,showSizeChanger:!0,showTotal:e=>`Total ${e} items`,position:["bottomRight"]},onChange:(e,l,h)=>{const d=h,f={field:d.field||"inuseSpace",order:d.order||null};A(f),x(e.current,e.pageSize,f.field,f.order==="ascend")},size:"small",rowKey:(e,l)=>`${e.func}-${e.file}-${e.line}-${l}`})]})]})}export{ie as default};
