import{d as S,c as T,u as P,j as i}from"./index-BERtlmQb.js";import{C as $}from"./index-DCpAUovq.js";import{u as E,C as N}from"./useChart-BUFOfR3x.js";import{r as m}from"./vendor-core-D3G3Pc5t.js";import{useTimeRange as A}from"./api-latency-chart-CP2UWLJS.js";import{M as F,q as O}from"./vendor-ui-DHYkxuVK.js";const v=(a,l)=>T.get({url:"/om/host/usage",params:{page:a,size:l}}),_=(a,l,r,s)=>T.get({url:"/om/host/usage/time",params:{start:a,end:l,unit:r,filter:s},paramsSerializer:{serialize:p=>{const u=new URLSearchParams;for(const[w,h]of Object.entries(p))if(Array.isArray(h))for(const d of h)u.append(w,d);else u.append(w,String(h));return u.toString()}}}),z=S(v,200),H=S(_,200);let k=null,y=null,D=0;const K=200;function I(a,l){const r=Date.now();return k&&r-D<K?Promise.resolve(k):y||(y=v(a,l).then(s=>(k=s,D=Date.now(),y=null,s)),y)}const q={usage:z,getCachedUsage:I,usageTimeRange:H};function B({open:a,onClose:l,resourceType:r}){const{t:s}=P(),{timeUnit:p,getRange:u,dateLabelFormat:w,renderTimePicker:h}=A("hour"),[d,j]=m.useState([]),[o,b]=m.useState(r);m.useEffect(()=>{b(r)},[r]);const x=m.useCallback(async e=>{try{const n=u(e),c=(()=>{switch(o){case"cpu":return["cpu","appCpu"];case"memory":return["mem","appMem","totalMem"];case"disk":return["disk","appDisk","totalDisk"];default:return[]}})(),C=await q.usageTimeRange(n.start,n.end,n.apiUnit,c);j(C)}catch{}finally{}},[o,u]);m.useEffect(()=>{a&&b(r)},[a,r]),m.useEffect(()=>{a&&x(p)},[a,p,x]);const U=e=>{b(e)},L=()=>{if(!d.length)return[];const e=(t,f,g)=>{switch(g){case"cpu":return Math.min(t,100);case"memory":case"disk":return Math.min(t/f*100,100);default:return 0}},c=(t=>{switch(t){case"cpu":return{host:"cpu",app:"appCpu"};case"memory":return{host:"mem",app:"appMem",total:"totalMem"};case"disk":return{host:"disk",app:"appDisk",total:"totalDisk"};default:return{host:"cpu",app:"appCpu"}}})(o);return[{name:s(`sys.workbench.${o}AppUsage`),data:d.map(t=>{const f=t.value[c.app]||0,g=c.total&&t.value[c.total]||1;return{x:Number(t.at)*1e3,y:e(f,g,o)}})},{name:s(`sys.workbench.${o}HostUsage`),data:d.map(t=>{const f=t.value[c.host]||0,g=c.total&&t.value[c.total]||1;return{x:Number(t.at)*1e3,y:e(f,g,o)}})}]},M=E({xaxis:{type:"datetime",labels:{datetimeUTC:!1,format:w}},tooltip:{x:{formatter:e=>{switch(p){case"hour":return new Date(e).toLocaleString();case"day":return new Date(e).toLocaleString();case"week":return(()=>{const n=new Date(e);return`${n.toLocaleDateString()} (${n.toLocaleDateString("en-US",{weekday:"short"})})`})();case"month":return new Date(e).toLocaleDateString();default:return new Date(e).toLocaleString()}}},y:{formatter:e=>`${e.toFixed(2)}%`}},yaxis:{labels:{formatter:e=>`${e.toFixed(2)}%`},max:100},chart:{toolbar:{show:!1}},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.45,opacityTo:.05,stops:[0,100]}},stroke:{curve:"smooth",width:2}}),R=[{key:"cpu",label:s("sys.workbench.cpu")},{key:"memory",label:s("sys.workbench.memory")},{key:"disk",label:s("sys.workbench.disk")}];return i.jsx(F,{title:s(`sys.workbench.${o}UsageHistory`),open:a,onCancel:l,width:900,footer:null,style:{top:"15%"},styles:{body:{padding:"0px"}},children:i.jsxs($,{className:"flex-col !shadow-none",children:[i.jsxs("header",{className:"flex w-full justify-between items-center self-start mb-4",children:[i.jsx(O,{activeKey:o,onChange:U,items:R,size:"small"}),h()]}),i.jsx("main",{className:"w-full",children:i.jsx(N,{type:"area",series:L(),options:M,height:350,style:{marginLeft:"-15px"}})})]})})}const Y=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{B as R,q as h,Y as r};
