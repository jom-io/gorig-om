import{d,c as x,u as A,j as a,t as g}from"./index-CwQ1I2ZT.js";import{M as R,q as z,S as I,H as M,a9 as m,s as f,T as k,z as O,aa as P,i as v,ab as C}from"./vendor-ui-Dp3kvFmo.js";import{r as u}from"./vendor-core-D3G3Pc5t.js";const E=(t,i,s,c)=>x.get({url:"/om/stat/error/time",params:{start:t,end:i,unit:s,filter:c},paramsSerializer:{serialize:r=>{const e=new URLSearchParams;for(const[n,o]of Object.entries(r))if(Array.isArray(o))for(const p of o)e.append(n,p);else e.append(n,String(o));return e.toString()}}}),N=d(E,200),q=(t,i,s,c)=>x.get({url:"/om/stat/error/top",params:{start:t,end:i,limit:s,filter:c},paramsSerializer:{serialize:r=>{const e=new URLSearchParams;for(const[n,o]of Object.entries(r))if(Array.isArray(o))for(const p of o)e.append(n,p);else e.append(n,String(o));return e.toString()}}}),U=d(q,200),D=(t,i,s,c)=>x.get({url:"/om/stat/api/time",params:{start:t,end:i,unit:s,filter:c},paramsSerializer:{serialize:r=>{const e=new URLSearchParams;for(const[n,o]of Object.entries(r))if(Array.isArray(o))for(const p of o)e.append(n,p);else o!==void 0&&e.append(n,String(o));return e.toString()}}}),_=(t,i,s=200)=>x.get({url:"/om/stat/api/summary",params:{start:t,end:i,slowMs:s}}),Y=t=>x.get({url:"/om/stat/api/top",params:t,paramsSerializer:{serialize:i=>{const s=new URLSearchParams;for(const[c,r]of Object.entries(i))if(Array.isArray(r))for(const e of r)s.append(c,e);else r!==void 0&&s.append(c,String(r));return s.toString()}}}),H=(t,i,s)=>x.get({url:"/om/stat/api/sample",params:{method:t,uri:i,types:s},paramsSerializer:{serialize:c=>{const r=new URLSearchParams;for(const[e,n]of Object.entries(c))if(Array.isArray(n))for(const o of n)r.append(e,o);else n!==void 0&&r.append(e,String(n));return r.toString()}}}),V={errorTimeRange:N,errorTop:U,apiTimeRange:d(D,200),apiSummary:d(_,200),apiTop:d(Y,200),apiSample:d(H,200)};function B({open:t,onClose:i,method:s,uri:c,type:r}){const{t:e}=A(),[n,o]=u.useState(!1),[p,b]=u.useState(null),[S,j]=u.useState(r);u.useEffect(()=>{t&&j(r)},[t,r]),u.useEffect(()=>{t&&s&&c&&(async()=>{o(!0);try{const h=await V.apiSample(s,c,["latest","2xx","4xx","5xx","slow"]);b(h)}catch{b(null)}finally{o(!1)}})()},[t,s,c]);const l=u.useMemo(()=>{if(!p)return null;switch(S){case"latest":return p.latest;case"2xx":return p.sample2xx;case"4xx":return p.sample4xx;case"5xx":return p.sample5xx;case"slow":return p.sampleSlow;default:return null}},[p,S]),w=y=>y?a.jsx("div",{className:"bg-neutral-100 dark:bg-neutral-800 p-3 rounded-md overflow-auto max-h-60",children:a.jsx("pre",{className:"text-xs",style:{color:g.colors.text.secondary},children:JSON.stringify(y,null,2)})}):null,T=()=>{if(!l)return;const y=l.requestAt-6e4,h=`#/log?traceID=${l.traceId}&startTime=${y}`;window.open(h,"_blank")},L=[{key:"latest",label:e("sys.workbench.apiSampleLatest","Latest")},{key:"2xx",label:"2xx"},{key:"4xx",label:"4xx"},{key:"5xx",label:"5xx"},{key:"slow",label:e("sys.workbench.apiSampleSlow","Slow")}];return a.jsxs(R,{title:e("sys.workbench.apiSample","Request Sample"),open:t,onCancel:i,width:800,footer:[a.jsx(v,{onClick:i,children:e("sys.connect.cancel","Close")},"close"),a.jsx(v,{type:"primary",icon:a.jsx(C,{}),disabled:!l,onClick:T,children:e("sys.workbench.viewLinkLogs","View Link Logs")},"logs")],destroyOnClose:!0,children:[a.jsx(z,{activeKey:S,onChange:j,items:L,className:"mb-4"}),a.jsx(I,{spinning:n,children:l?a.jsxs(M,{direction:"vertical",className:"w-full",size:"large",children:[a.jsxs(m,{bordered:!0,size:"small",column:1,children:[a.jsx(m.Item,{label:"Trace ID",children:a.jsx(f.Text,{copyable:!0,children:l.traceId})}),a.jsx(m.Item,{label:e("sys.workbench.apiColMethod","Method"),children:a.jsx(k,{color:"blue",children:s})}),a.jsx(m.Item,{label:"URL",children:a.jsx(f.Text,{style:{wordBreak:"break-all"},children:l.url})}),a.jsx(m.Item,{label:e("sys.workbench.requestTime","Request Time"),children:O(l.requestAt).format("YYYY-MM-DD HH:mm:ss.SSS")}),a.jsx(m.Item,{label:e("sys.workbench.apiColStatus","Status"),children:a.jsx(k,{color:l.status>=500?"error":l.status>=400?"warning":"success",children:l.status})}),a.jsx(m.Item,{label:e("sys.workbench.apiColLatency","Latency"),children:a.jsxs(f.Text,{strong:!0,style:{color:l.latencyMs>500?g.colors.palette.error.dark:l.latencyMs>200?g.colors.palette.warning.dark:void 0},children:[l.latencyMs," ms"]})})]}),a.jsxs("div",{children:[a.jsx(f.Title,{level:5,children:e("sys.workbench.apiInLog","In Log")}),w(l.inLog)]}),a.jsxs("div",{children:[a.jsx(f.Title,{level:5,children:e("sys.workbench.apiOutLog","Out Log")}),w(l.outLog)]})]}):!n&&a.jsx(P,{description:e("sys.workbench.apiNoSample","No sample data for this type")})})]})}const F=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{B as A,F as a,V as s};
