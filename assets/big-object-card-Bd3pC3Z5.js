import{u as G,a as K,j as t,t as s}from"./index-AHjT66P3.js";import{s as N}from"./statService-CxUvAms7.js";import{C as W}from"./index-Bc1co6Wu.js";import{z as g,S as V,M as _,G as q}from"./vendor-ui-B8JNe9Dz.js";import{r as o}from"./vendor-core-D3G3Pc5t.js";import J from"./RefreshIcon-DSzYLikf.js";import{useTimeRange as Q}from"./api-latency-chart-BEhE8p-9.js";import"./vendor-utils-9ATX-dPw.js";import"./chart-DWnyXj9S.js";import"./vendor-charts-C0vSEv4L.js";import"./useChart-CgyA-rHf.js";import"./api-sample-modal-DLs4z4SQ.js";const M=n=>{if(n===0)return"0 B";const a=1024,S=["B","KB","MB","GB"],x=Math.floor(Math.log(Math.abs(n))/Math.log(a));return`${(n/a**x).toFixed(2)} ${S[x]}`};function de(){const{t:n}=G(),a=K(),[S,x]=o.useState(!1),[B,T]=o.useState(0),[w,$]=o.useState(""),[i,k]=o.useState(!1),[R,A]=o.useState([]),[D,O]=o.useState(!1),[c,y]=o.useState({current:1,pageSize:10,total:0}),[r,H]=o.useState({field:"inuseSpace",order:"descend"}),z=o.useRef(!1),{timeUnit:d,timeRange:h,setTimeRange:v,getRange:C,renderTimePicker:I}=Q("today",[g().startOf("day"),g()]),b=o.useCallback(async()=>{if(a)try{x(!0);const e=g(),l=e.startOf("day").unix(),m=e.unix(),f=await N.memBigCount(l,m);T(f),$(e.format("HH:mm"))}catch{}finally{x(!1)}},[a]),u=o.useCallback(async(e=1,l=10,m="inuseSpace",f=!1)=>{if(a)try{O(!0);const{start:p,end:U}=C(d),j=await N.memBigTop({start:p,end:U,page:e,size:l,sortBy:m,asc:f});A(j.items||[]),y(P=>({...P,current:j.page||1,pageSize:j.size||10,total:j.total||0}))}catch{}finally{O(!1)}},[a,d,C]);o.useEffect(()=>{a&&b()},[a,b]);const E=()=>{k(!0),y(e=>({...e,current:1}))},F=o.useCallback(e=>{e.stopPropagation(),b(),i&&a&&u(c.current,c.pageSize,r.field,r.order==="ascend")},[b,i,a,u,c.current,c.pageSize,r.field,r.order]);o.useEffect(()=>{i&&a&&y(e=>({...e,current:1}))},[i,a,d,h]),o.useEffect(()=>{const e=z.current;z.current=i,i&&!e&&d==="today"&&h?.[0]&&v([h[0],g()]),i&&a&&(!e||d||h)&&u(1,c.pageSize,r.field,r.order==="ascend")},[i,a,d,h,v,u,c.pageSize,r.field,r.order]);const L=[{title:n("sys.workbench.bigObjectFunc"),dataIndex:"func",key:"func",width:400,render:(e,l)=>t.jsxs("div",{className:"flex flex-col py-0.5",style:{wordBreak:"break-all",whiteSpace:"normal"},children:[t.jsx("span",{style:{fontSize:"13px",fontFamily:"monospace",fontWeight:600,color:s.colors.text.primary,wordBreak:"break-all",whiteSpace:"normal",lineHeight:"1.4"},children:e}),t.jsxs("span",{className:"mt-0.5",style:{fontSize:"11px",color:s.colors.text.secondary,wordBreak:"break-all",whiteSpace:"normal",lineHeight:"1.4"},children:[l.file,":",l.line]})]})},{title:n("sys.workbench.bigObjectSpace"),dataIndex:"inuseSpace",key:"inuseSpace",width:80,align:"right",sorter:!0,sortOrder:r.field==="inuseSpace"?r.order:null,render:e=>t.jsx("span",{style:{fontSize:"13px",fontWeight:700,color:s.colors.palette.warning.dark},children:M(e)})},{title:n("sys.workbench.bigObjectObjects"),dataIndex:"inuseObjects",key:"inuseObjects",width:60,align:"right",sorter:!0,sortOrder:r.field==="inuseObjects"?r.order:null,render:e=>t.jsx("span",{style:{fontSize:"13px",color:s.colors.text.primary},children:e.toLocaleString()})},{title:n("sys.workbench.bigObjectAvgSize"),dataIndex:"avgObjSize",key:"avgObjSize",width:80,align:"right",sorter:!0,sortOrder:r.field==="avgObjSize"?r.order:null,render:e=>t.jsx("span",{style:{fontSize:"13px",color:s.colors.text.secondary},children:M(e)})},{title:n("sys.workbench.bigObjectLastAt"),dataIndex:"lastAt",key:"lastAt",width:80,align:"center",sorter:!0,sortOrder:r.field==="lastAt"?r.order:null,render:e=>{if(!e)return t.jsx("span",{style:{fontSize:"12px",color:s.colors.text.secondary},children:"-"});const l=g.unix(e);return t.jsxs("div",{className:"flex flex-col py-0.5",children:[t.jsx("span",{style:{fontSize:"12px",color:s.colors.text.primary},children:l.format("YYYY-MM-DD")}),t.jsx("span",{style:{fontSize:"11px",color:s.colors.text.secondary},children:l.format("HH:mm:ss")})]})}}],Y=`linear-gradient(135deg, rgba(${s.colors.palette.warning.lightChannel}, 0.12), rgba(${s.colors.palette.primary.lightChannel}, 0.14)) ${s.colors.background.paper}`;return t.jsxs(t.Fragment,{children:[t.jsx(W,{className:"!p-0 overflow-hidden cursor-pointer hover:shadow-lg transition-shadow",onClick:E,style:{background:Y,padding:0,boxShadow:s.shadows.card,height:133,width:"100%",display:"flex",flexDirection:"column",flexShrink:0},children:t.jsx(V,{spinning:S,style:{height:"100%"},wrapperClassName:"flex-1 flex flex-col",children:t.jsx("div",{className:"flex h-full flex-col justify-center p-4",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("div",{className:"text-lg font-medium",style:{color:s.colors.text.primary},children:n("sys.workbench.bigObjectTop")}),t.jsx("div",{className:"text-xs",style:{color:s.colors.text.secondary},children:n("sys.workbench.bigObjectDesc")}),t.jsxs("div",{className:"flex items-baseline gap-2 mt-6",children:[t.jsx("div",{className:"text-2xl font-bold",style:{color:s.colors.text.primary},children:B}),t.jsx("div",{className:"text-xs",style:{color:s.colors.text.secondary},children:n("sys.workbench.bigObjectUnit")})]})]}),t.jsxs("div",{className:"flex flex-col items-end gap-1 justify-center",children:[t.jsx(J,{background:`rgba(${s.colors.palette.warning.defaultChannel}, 0.18)`,color:s.colors.palette.warning.dark,icon:"mdi:database",onClick:F}),w&&t.jsx("span",{className:"mt-4 text-xs whitespace-nowrap",style:{color:s.colors.text.secondary},children:n("sys.workbench.bigObjectUpdatedAt",{time:w})})]})]})})})}),t.jsxs(_,{title:t.jsx("span",{className:"text-lg font-bold",children:n("sys.workbench.bigObjectTop")}),open:i,onCancel:()=>k(!1),footer:null,width:1e3,centered:!0,styles:{body:{paddingTop:"12px",maxHeight:"calc(100vh - 200px)",overflowY:"auto"}},children:[t.jsx("div",{className:"mb-4 flex items-center justify-end gap-2",children:I(()=>{y(e=>({...e,current:1}))})}),t.jsx(q,{dataSource:R,columns:L,loading:D,pagination:{...c,showSizeChanger:!0,showTotal:e=>`Total ${e} items`,position:["bottomRight"]},onChange:(e,l,m)=>{const f=m,p={field:f.field||"inuseSpace",order:f.order||null};H(p),u(e.current,e.pageSize,p.field,p.order==="ascend")},size:"small",rowKey:(e,l)=>`${e.func}-${e.file}-${e.line}-${l}`})]})]})}export{de as default};
