import{u as I,a as z,t,j as e}from"./index-P1Zoe_e-.js";import{s as w}from"./statService-BhweNbWR.js";import{C as F}from"./index-D8fx2Vbs.js";import{z as C,S as L}from"./vendor-ui-B8JNe9Dz.js";import{r as n}from"./vendor-core-D3G3Pc5t.js";import M from"./RefreshIcon-DrxWf48Q.js";import q from"./error-chart-CxrSIFJQ.js";import"./vendor-utils-9ATX-dPw.js";import"./chart-DNWa1HhJ.js";import"./vendor-charts-C0vSEv4L.js";import"./useChart-Dnju82ll.js";import"./anomaly-sample-modal-B2QPLH4_.js";import"./api-latency-chart-BR-VX1ji.js";import"./api-sample-modal-BmHuuW_5.js";function te(){const{t:l}=I(),c=z(),[x,h]=n.useState(!1),[v,N]=n.useState({error:0,panic:0}),[y,g]=n.useState(""),[S,b]=n.useState(!1),[$,E]=n.useState({error:null,panic:null}),i=n.useCallback(async()=>{if(c)try{b(!0);const r=C(),s=r.startOf("day").unix(),d=r.unix(),m=await w.errorTimeRange(s,d,"5m",["error","panic"]),p={error:0,panic:0};for(const a of m){const o=a.value;p.error+=o.error||0,p.panic+=o.panic||0}N(p);const H=d-s,j=r.subtract(1,"day").startOf("day").unix(),O=j+H,V=await w.errorTimeRange(j,O,"5m",["error","panic"]),f={error:0,panic:0};for(const a of V){const o=a.value;f.error+=o.error||0,f.panic+=o.panic||0}const u={error:null,panic:null};for(const a of["error","panic"]){const o=f[a],k=p[a];o===0?u[a]=k>0?100:0:u[a]=(k-o)/o*100}if(E(u),m.length>0){const a=Number(m[m.length-1].at);g(C.unix(a).format("HH:mm"))}else g("")}catch{}finally{b(!1)}},[c]);n.useEffect(()=>{i()},[i]);const R=n.useMemo(()=>[{key:"error",label:l("sys.workbench.anomalyError"),color:t.colors.palette.error.dark},{key:"panic",label:l("sys.workbench.anomalyPanic"),color:t.colors.palette.error.default}],[l]),T=()=>{!c||x||h(!0)},A=n.useCallback(r=>{r.stopPropagation(),i()},[i]),P=`linear-gradient(135deg, rgba(${t.colors.palette.error.lightChannel}, 0.14), rgba(${t.colors.palette.primary.lightChannel}, 0.12)) ${t.colors.background.paper}`,U=r=>{const s=$[r];if(s==null)return null;const d=s>=0;return{text:`${s>0?"+":""}${s.toFixed(1)}% ${l("sys.workbench.anomalyChange")}`,color:d?"#ff4d4f":"#52c41a"}};return e.jsxs("div",{onClick:T,className:"h-full w-full",children:[e.jsx(L,{spinning:S,className:"h-full",children:e.jsx(F,{className:"!p-0 overflow-hidden w-full",style:{background:P,padding:0,boxShadow:t.shadows.card,cursor:"pointer",minHeight:133,flexShrink:0},children:e.jsx("div",{className:"flex h-full flex-col gap-4 p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",style:{color:t.colors.text.primary},children:l("sys.workbench.anomalyToday")}),e.jsx("div",{className:"mt-3 flex flex-wrap items-end gap-4 justify-between",children:e.jsx("div",{className:"flex flex-wrap gap-4",children:R.map(r=>{const s=U(r.key);return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase",style:{color:r.color},children:r.label}),e.jsx("span",{className:"text-2xl font-bold",style:{color:t.colors.text.primary},children:v[r.key]??0}),e.jsx("span",{className:"text-sm",style:{color:t.colors.text.secondary},children:l("sys.workbench.anomalyUnit")})]}),s&&e.jsx("span",{className:"text-xs mt-1",style:{color:s.color},children:s.text})]},r.key)})})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 justify-start mt-1",children:[e.jsx(M,{background:`rgba(${t.colors.palette.error.defaultChannel}, 0.16)`,color:t.colors.palette.error.dark,icon:"mdi:alert-decagram",onClick:A}),y&&e.jsx("span",{className:"text-xs mt-4 whitespace-nowrap",style:{color:t.colors.text.secondary},children:l("sys.workbench.anomalyUpdated",{time:y})})]})]})})})}),e.jsx(q,{open:x,onClose:()=>h(!1),enabled:!!c})]})}export{te as default};
