import{u as T,j as e,t as p}from"./index-B8gF60y7.js";import{s as v}from"./statService-CguRoBzC.js";import{M as I,q as M,S as C,H as N,a9 as l,s as c,T as k,z as q,ad as D,i as S,aa as E}from"./vendor-ui-B8JNe9Dz.js";import{r}from"./vendor-core-D3G3Pc5t.js";import"./vendor-utils-9ATX-dPw.js";function H({open:n,onClose:h,method:i,uri:d,type:u}){const{t}=T(),[y,b]=r.useState(!1),[a,w]=r.useState(null),[m,j]=r.useState(u);r.useEffect(()=>{n&&j(u)},[n,u]),r.useEffect(()=>{n&&i&&d&&(async()=>{b(!0);try{const x=await v.apiSample(i,d,["latest","2xx","4xx","5xx","slow"]);w(x)}catch{w(null)}finally{b(!1)}})()},[n,i,d]);const s=r.useMemo(()=>{if(!a)return null;switch(m){case"latest":return a.latest;case"2xx":return a.sample2xx;case"4xx":return a.sample4xx;case"5xx":return a.sample5xx;case"slow":return a.sampleSlow;default:return null}},[a,m]),f=o=>o?e.jsx("div",{className:"bg-neutral-100 dark:bg-neutral-800 p-3 rounded-md overflow-auto max-h-60",children:e.jsx("pre",{className:"text-xs",style:{color:p.colors.text.secondary},children:JSON.stringify(o,null,2)})}):null,g=()=>{if(!s)return;const o=s.requestAt-6e4,x=`#/log?traceID=${s.traceId}&startTime=${o}`;window.open(x,"_blank")},L=[{key:"latest",label:t("sys.workbench.apiSampleLatest","Latest")},{key:"2xx",label:"2xx"},{key:"4xx",label:"4xx"},{key:"5xx",label:"5xx"},{key:"slow",label:t("sys.workbench.apiSampleSlow","Slow")}];return e.jsxs(I,{title:t("sys.workbench.apiSample","Request Sample"),open:n,onCancel:h,width:800,footer:[e.jsx(S,{onClick:h,children:t("sys.connect.cancel","Close")},"close"),e.jsx(S,{type:"primary",icon:e.jsx(E,{}),disabled:!s,onClick:g,children:t("sys.workbench.viewLinkLogs","View Link Logs")},"logs")],destroyOnClose:!0,children:[e.jsx(M,{activeKey:m,onChange:j,items:L,className:"mb-4"}),e.jsx(C,{spinning:y,children:s?e.jsxs(N,{direction:"vertical",className:"w-full",size:"large",children:[e.jsxs(l,{bordered:!0,size:"small",column:1,children:[e.jsx(l.Item,{label:"Trace ID",children:e.jsx(c.Text,{copyable:!0,children:s.traceId})}),e.jsx(l.Item,{label:t("sys.workbench.apiColMethod","Method"),children:e.jsx(k,{color:"blue",children:i})}),e.jsx(l.Item,{label:"URL",children:e.jsx(c.Text,{style:{wordBreak:"break-all"},children:s.url})}),e.jsx(l.Item,{label:t("sys.workbench.requestTime","Request Time"),children:q(s.requestAt).format("YYYY-MM-DD HH:mm:ss.SSS")}),e.jsx(l.Item,{label:t("sys.workbench.apiColStatus","Status"),children:e.jsx(k,{color:s.status>=500?"error":s.status>=400?"warning":"success",children:s.status})}),e.jsx(l.Item,{label:t("sys.workbench.apiColLatency","Latency"),children:e.jsxs(c.Text,{strong:!0,style:{color:s.latencyMs>500?p.colors.palette.error.dark:s.latencyMs>200?p.colors.palette.warning.dark:void 0},children:[s.latencyMs," ms"]})})]}),e.jsxs("div",{children:[e.jsx(c.Title,{level:5,children:t("sys.workbench.apiInLog","In Log")}),f(s.inLog)]}),e.jsxs("div",{children:[e.jsx(c.Title,{level:5,children:t("sys.workbench.apiOutLog","Out Log")}),f(s.outLog)]})]}):!y&&e.jsx(D,{description:t("sys.workbench.apiNoSample","No sample data for this type")})})]})}export{H as default};
