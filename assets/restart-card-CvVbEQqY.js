import{d as at,c as E,u as ot,j as e}from"./index-DXkbx-7a.js";import{z as c,s as nt,i as x,C as ct,H as it,G as lt,M as R,E as $}from"./vendor-ui-BgnAtmuh.js";import{r}from"./vendor-core-Cler3e7Q.js";import"./vendor-utils-Dg5_7-NF.js";const dt=()=>E.post({url:"/om/app/restart"}),ut=(t,o)=>E.get({url:"/om/app/restart/logs",params:{page:t,size:o}}),mt=at(ut,200),p={restart:dt,restartLogs:mt},{Text:i}=nt,Y=t=>{switch(t){case"manual":return"#52c41a";case"deploy":return"#1890ff";case"crash":return"#ff4d4f";default:return"#000000"}},D=(t,o)=>{switch(t){case"manual":return o("sys.restart.manual");case"deploy":return o("sys.restart.deploy");case"crash":return o("sys.restart.crash");default:return o("sys.restart.unknown")}},m=t=>t.toString().padStart(2,"0"),pt=()=>{const{t}=ot(),[o,H]=r.useState(null),[z,g]=r.useState(!1),[d,w]=r.useState(0),[I,S]=r.useState(!1),[l,V]=r.useState(!1),[j,B]=r.useState([]),[P,_]=r.useState(0),[f,F]=r.useState(1),[y]=r.useState(10),[G,T]=r.useState(!1),[K,b]=r.useState(!1),[O,q]=r.useState(""),v=r.useCallback(async()=>{try{g(!0);const s=await p.restartLogs(0,1);if(s.items&&s.items.length>0){H(s.items[0]);const a=c.unix(s.items[0].startTime),n=c();w(n.diff(a,"second"))}}catch{}finally{g(!1)}},[]),M=r.useCallback(async(s,a)=>{try{T(!0);const n=await p.restartLogs(s,a);B(n.items),_(n.total)}catch{}finally{T(!1)}},[]);r.useEffect(()=>{v()},[v]),r.useEffect(()=>{l&&M(f,y)},[l,f,y,M]),r.useEffect(()=>{const s=setInterval(()=>{w(a=>a+1)},1e3);return()=>clearInterval(s)},[]);const A=()=>{R.confirm({title:t("sys.restart.confirmTitle"),content:t("sys.restart.confirmContent"),onOk:async()=>{try{S(!0),await p.restart(),$.success(t("sys.restart.restarting")),setTimeout(()=>{window.location.reload()},3e3)}catch{$.error(t("sys.restart.failed"))}finally{S(!1)}}})},J=s=>{F(s)},Q=s=>{q(s),b(!0)},C=(s,a)=>{const n=c.unix(s),u=(a?c.unix(a):c()).diff(n,"second"),N=Math.floor(u/86400),st=Math.floor(u%86400/3600),et=Math.floor(u%3600/60),rt=u%60;let h="";return N>0&&(h+=`${N}${t("sys.restart.day")}`),h+=`${st}${t("sys.restart.hour")}${m(et)}${t("sys.restart.minute")}${m(rt)}${t("sys.restart.second")}`,h},U=[{title:t("sys.restart.startTime"),dataIndex:"startTime",key:"startTime",width:180,render:s=>c.unix(s).format("YYYY-MM-DD HH:mm:ss")},{title:t("sys.restart.duration"),key:"duration",width:180,render:(s,a,n)=>{if(n===0)return C(a.startTime);const k=j[n-1];return C(a.startTime,k.startTime)}},{title:t("sys.restart.startType"),dataIndex:"startSrc",key:"startSrc",width:100,render:s=>e.jsx(i,{style:{color:Y(s)},children:D(s,t)})},{title:t("sys.restart.operation"),key:"operation",width:100,align:"center",render:(s,a)=>e.jsx(x,{type:"link",size:"small",onClick:()=>Q(a.log),children:t("sys.restart.viewLog")})}];if(!o)return null;const L=Math.floor(d/86400),W=Math.floor(d%86400/3600),X=Math.floor(d%3600/60),Z=d%60,tt=c.unix(o.startTime);return e.jsxs(ct,{className:"w-full",loading:z,bodyStyle:{padding:"12px 24px"},children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(i,{className:"text-gray-500",children:[t("sys.restart.runningTime"),"："]}),e.jsxs(i,{strong:!0,className:"text-base",children:[L>0?`${L}${t("sys.restart.day")}`:"",W,t("sys.restart.hour"),m(X),t("sys.restart.minute"),m(Z),t("sys.restart.second")]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(i,{className:"text-gray-500",children:[t("sys.restart.startTime"),"："]}),e.jsx(i,{children:tt.format("YYYY-MM-DD HH:mm:ss")})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(i,{className:"text-gray-500",children:[t("sys.restart.startType"),"："]}),e.jsx(i,{style:{color:Y(o.startSrc)},children:D(o.startSrc,t)})]})]}),e.jsxs(it,{children:[e.jsx(x,{onClick:()=>V(!l),children:t(l?"sys.restart.collapse":"sys.restart.moreRecords")}),e.jsx(x,{type:"primary",onClick:A,loading:I,className:"!bg-[#faad14] !border-[#faad14] hover:!bg-[#ffc53d] hover:!border-[#ffc53d]",children:t("sys.restart.restart")})]})]}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out ${l?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:e.jsx("div",{className:"mt-4",children:e.jsx(lt,{columns:U,dataSource:j,rowKey:s=>s.startTime.toString(),pagination:{current:f,pageSize:y,total:P,onChange:J},loading:G,size:"small"})})}),e.jsx(R,{title:t("sys.restart.logDetail"),open:K,onCancel:()=>b(!1),footer:null,width:"50vw",styles:{body:{maxHeight:"60vh",overflowY:"auto",whiteSpace:"pre-wrap",wordBreak:"break-word"}},children:O})]})};export{pt as default};
